/*
===============================================================================================================================
               ULTIMAS ATUALIZAÇÕES EFETUADAS - CONSULTAR LOG DO VERSIONADOR PARA HISTORICO COMPLETO
===============================================================================================================================
 Autor        |    Data    |                              Motivo                      										 
-------------------------------------------------------------------------------------------------------------------------------
André Lisboa  | 28/11/2017 | Validar se a baixa é por item ou por toda SA - Chamado 22688 
-------------------------------------------------------------------------------------------------------------------------------
 Alex Wallauer| 04/09/2018 | Coloquei a gravação do campo D3_I_NUMCP - Chamado 26146
===============================================================================================================================
 Analista     - Programador  - Inicio   - Envio    - Chamado - Motivo da Alteração
===========================================================================================================================================================================================================
Bruno         - Julio Paz    - 06/03/25 - 25/04/25 - 50005   - Desenvolvimento de novos controles na rotina de baixa de EPI. Limpar o conteúdo do campo TNF_I_OBS na Entrega do EPI.
===========================================================================================================================================================================================================
*/

//====================================================================================================
// Definicoes de Includes da Rotina.
//====================================================================================================
#INCLUDE "PROTHEUS.CH"

/*
===============================================================================================================================
Programa----------: M185GRV
Autor-------------: Josué Danich Prestes	
Data da Criacao---: 14/11/2017
===============================================================================================================================
Descrição---------: Ponto de entrada após gravação da baixa de solicitação ao armazém - Chamado 22385
===============================================================================================================================
Parametros--------: Nenhum
===============================================================================================================================
Retorno-----------: Nenhum
===============================================================================================================================*/
User Function M185GRV( )
Local _nI 

If isincallstack("A185GERAAUT")
	IF !EMPTY(CCC) .OR. EMPTY(SD3->D3_I_NUMCP)

		Reclock("SD3",.F.)
	    IF !EMPTY(CCC)
		   SD3->D3_CC :=  alltrim(CCC)
		ENDIF   
        If EMPTY(SD3->D3_I_NUMCP)
	  	   SD3->D3_I_NUMCP := SCP->CP_NUM
        ENDIF
		SD3->(Msunlock())

	Endif
	
	//===================================================================
	// Desenvolvimento de novos controles na rotina de entrega de EPIs. 
	// Limpar o conteúdo do campo TNF_I_OBS na entrega do EPI. 
	//===================================================================
	TNF->(DbSetOrder(6)) // TNF_FILIAL+TNF_NUMSA+TNF_ITEMSA
    For _nI := 1 To Len(aDadosCQ)
	                  // Filial       + Codigo SA     + Item SA    
        If TNF->(MsSeek(xFilial("TNF")+aDadosCQ[_nI,2]+aDadosCQ[_nI,3]))
           If TNF->TNF_INDDEV == "2"
              TNF->(Reclock("TNF",.F.))
              TNF->TNF_I_OBS := ""
              TNF->(Msunlock())
		   EndIf 
		EndIf 
	Next 
	
EndIf

Return Nil
