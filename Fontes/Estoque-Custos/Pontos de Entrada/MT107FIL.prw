/*
===============================================================================================================================
                                    ATUALIZACOES SOFRIDAS DESDE A CONSTRUÇAO INICIAL
===============================================================================================================================
       Autor      |    Data    |                                             Motivo                                           |
------------------:------------:----------------------------------------------------------------------------------------------:
 Josué Danich     | 24/09/2015 | Ajuste geral da rotina para implantação de processo - Chamado 11950                          |
===============================================================================================================================
*/
//====================================================================================================
// Definicoes de Includes da Rotina.
//====================================================================================================

#include "protheus.ch"
#include "rwmake.ch"

/*
===============================================================================================================================
Programa--------: MT107FIL
Autor-----------: Andre Lisboa
Data da Criacao-: 24/08/2015
===============================================================================================================================
Descrição-------: P.E. para filtrar Mbrowse rotina MATA107
===============================================================================================================================
Uso-------------: Italac
===============================================================================================================================
Parametros------: Nenhum
===============================================================================================================================
Retorno---------: _cFiltro - string de filtro para mbrowse
===============================================================================================================================
Usuario---------: Andre Lisboa
===============================================================================================================================
Setor-----------: TI
*/
User Function MT107FIL()

Local  _cFiltro 		:= "CP_STATSA = 'Z'"
Local  _cUser			:= RetCodUsr()
Local  _cGrpApr		:= ""
Local  _aArea			:= Getarea()

//Lê grupo de aprovação do usuário Italac
_cGrpApr := alltrim(Posicione("ZZL",3,xFilial("ZZL")+_cUser,"ZZL->ZZL_GRPAPR"))

//Se o grupo de aprovação for válido e não for o grupo geral, faz o filtro pelo grupo de aprovação
If _cGrpApr <> "0" .AND. !(empty(_cGrpApr))

	_cFiltro := "CP_I_GRAPR == '" + _cGrpApr + "' .AND. CP_STATSA = 'B'"

//Se o grupo de aprovação for o geral então apresenta tudo que está bloqueado
Elseif _cGrpApr == "0"

	_cFiltro := "CP_STATSA = 'B'"

Endif

Restarea(_Aarea)

Return (_cFiltro)