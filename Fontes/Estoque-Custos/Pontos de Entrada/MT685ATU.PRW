/*
===============================================================================================================================
                                    ATUALIZACOES SOFRIDAS DESDE A CONSTRUÇAO INICIAL
===============================================================================================================================
       Autor      |    Data    |                                              Motivo                                          |
-------------------------------------------------------------------------------------------------------------------------------
===============================================================================================================================
*/
//====================================================================================================
// Definicoes de Includes da Rotina.
//====================================================================================================

#Include "Protheus.ch"
/*
===============================================================================================================================
Programa--------: MT685ATU
Autor-----------: Josué Danich Prestes
Data da Criacao-: 23/09/2015
===============================================================================================================================
Descrição-------: P.E. na rotina de apontamento de perdas chamado logo após gravar a SD3 - Chamado 11951
===============================================================================================================================
Uso-------------: Italac - Compras
===============================================================================================================================
Parametros------: Nenhum
===============================================================================================================================
Retorno---------: Nenhum
===============================================================================================================================
Setor-----------: TI
===============================================================================================================================
*/

User Function MT685ATU()

Local _cDoc := ""

	//Grava campo D3_I_ORIGE  com função que gerou
	DbSelectArea("SD3")	                     	
	SD3-> ( Dbsetorder(4) )
	
	If SD3->(Dbseek( xFilial("SD3") + SBC->BC_SEQSD3 ) )
	
		_cDoc := alltrim(SD3->D3_DOC)	
	
		SD3-> ( Dbsetorder(2) )
		SD3-> ( Dbgotop() )
	
		If SD3->(Dbseek( xFilial ("SD3") + _cDoc ))
		
			Do while Alltrim(SD3->D3_DOC) == _cDoc
		
				RecLock("SD3",.F.)    
	
				SD3->D3_I_ORIGE := funname()	
			
				("SD3")->(MsUnlock())
			
				SD3->(Dbskip ())
			
			Enddo
			       
		Endif
		
	EndIf

Return()