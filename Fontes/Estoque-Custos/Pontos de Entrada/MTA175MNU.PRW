/*
=====================================================================================================================================
        						 ULTIMAS ATUALIZAÇÕES EFETUADAS - CONSULTAR LOG DO VERSIONADOR PARA HISTORICO COMPLETO
=====================================================================================================================================
   Autor     |	Data	 |										Motivo																
-------------------------------------------------------------------------------------------------------------------------------------

=====================================================================================================================================
*/
#Include "Protheus.ch"

/*
===============================================================================================================================
Programa----------: MTA175MNU
Autor-------------: Alex Wallauer
Data da Criacao---: 17/07/2019  
===============================================================================================================================
Descrição---------: Ponto de entrada para criar um botao na tela liberacoes/rejeicoes do CQ. CHAMADO 30023
===============================================================================================================================
Parametros--------: Nenhum
===============================================================================================================================
ARetorno-----------: aBotao
===============================================================================================================================
*/
User Function MTA175MNU()

AADD(aRotina , {"Motivo do Retrabalho", 'U_MA175MR'	, 0, 2, 0, .F.}  )

Return aRotina

/*
===============================================================================================================================
Programa----------: MA175BUT
Autor-------------: Alex Wallauer
Data da Criacao---: 17/07/2019  
===============================================================================================================================
Descrição---------: SELECAO Motivo do Retrabalho
===============================================================================================================================
Parametros--------: Nenhum
===============================================================================================================================
ARetorno-----------: aBotao
===============================================================================================================================
*/
User Function MA175MR()

LOCAL lREt:=.F.

IF !EMPTY(SD7->D7_LIBERA) .AND. !U_ITMSG("O Produto já foi Liberado pelo C.Q. deseja alterar o campo Motivo mesmo assim?",'Atenção!',,3,2,2)
   RETURN .F.
ENDIF   

IF SD7->D7_TIPO = 2
   U_ITMSG("Linha Rejeitada. Campo motivo não pode ser aterado.",'Atenção!',,1)
   RETURN .F.
ENDIF   

DBSELECTAREA('CYO')
lREt := ConPad1(,,,'CYO003',,,.F.)

IF lREt
   SD7->(RecLock('SD7', .F.))
   SD7->D7_MOTREJE:=CYO->CYO_CDRF
   SD7->(MSUNLOCK())
ELSEIF !EMPTY(SD7->D7_MOTREJE) .AND. U_ITMSG("Deseja Limpar o campo Motivo ?",'Atenção!',,3,2,2)
   SD7->(RecLock('SD7', .F.))
   SD7->D7_MOTREJE:=""
   SD7->(MSUNLOCK())
ENDIF

RETURN 
