/*
===============================================================================================================================
                                    ATUALIZACOES SOFRIDAS DESDE A CONSTRUÇAO INICIAL
===============================================================================================================================
       Autor      |    Data    |                                             Motivo                                           |
-------------------------------------------------------------------------------------------------------------------------------
===============================================================================================================================
*/

//====================================================================================================
// Definicoes de Includes da Rotina.
//====================================================================================================
#include "protheus.ch"
#include "topconn.ch" 
/*
===============================================================================================================================
Programa----------: AOMS004 
Autor-------------: Josué Prestes
Data da Criacao---: 17/09/2015  
===============================================================================================================================
Descrição---------: Validação contra produto duplicado na tabela de preços - Chamado 11843	
===============================================================================================================================
Parametros--------: Nenhum
===============================================================================================================================
Retorno-----------: .t. ou .f.
===============================================================================================================================
*/
User Function AOMS004()

Local _aArea   := getarea()
Local _cRet	   := .T.
Local _cPospro := aScan( aHeader , {|x| UPPER( Alltrim(x[2]) ) == "DA1_CODPRO" } )
Local _cPosit  := aScan( aHeader , {|x| UPPER( Alltrim(x[2]) ) == "DA1_ITEM" } )


//============================================
//Procura se já tem produto na tabela atual
//============================================
If ascan( acols , {|x| UPPER( Alltrim(x[_cPospro]) ) ==  alltrim(M->DA1_CODPRO) .and. x[_cPosit] != acols[n][_cPosit]} ) > 0

	Help( ,, 'AOMS004',, "Já existe o produto " + alltrim(M->DA1_CODPRO) + " na tabela atual!", 1, 0 )
		
	_cRet := .F.
	
Endif

U_ITLOGACS()//Grava log de utilização da rotina

restarea(_aArea)	
	
return	_cRet

