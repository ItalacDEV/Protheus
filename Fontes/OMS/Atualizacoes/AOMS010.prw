/*
===============================================================================================================================
               ULTIMAS ATUALIZAÇÕES EFETUADAS - CONSULTAR LOG DO VERSIONADOR PARA HISTORICO COMPLETO
===============================================================================================================================
       Autor      |    Data    |                                             Motivo                                           
-------------------------------------------------------------------------------------------------------------------------------
 Josué Danich 	  | 19/04/2017 | Ajustado para sempre gravar o campo C6_I_QPALT - Chamado 19769
-------------------------------------------------------------------------------------------------------------------------------
Lucas Borges      | 15/10/2019 | Removidos os Warning na compilação da release 12.1.25. Chamado 28346
===============================================================================================================================
*/

//====================================================================================================
// Definicoes de Includes da Rotina.
//====================================================================================================
#Include "Rwmake.ch"
#include "Protheus.ch"
#include "TopConn.ch"

/*
===============================================================================================================================
Programa----------: AOMS010
Autor-------------: Renato de Morcerf
Data da Criacao---: 13/08/2008  
===============================================================================================================================
Descrição---------: Aplica regra para geracao da Quantidade do Pallet (C6_I_QPALT)
===============================================================================================================================
Parametros--------: Nenhum
===============================================================================================================================
Retorno-----------: Nenhum
===============================================================================================================================
*/
User Function AOMS010()

local cProduto
local qtdx  	:=	0
local _cxp  	:= 	0
local nqtv 		:= 	0
Local aArea    	:= 	GetArea("SB1")

nP			:=	aScan( aHeader, { |x| Alltrim(x[2])== "C6_PRODUTO" } )
cProduto 	:= 	acols[n,nP] // PRODUTO
nQ			:= 	aScan( aHeader, { |x| Alltrim(x[2])== "C6_UNSVEN" } )
qtdx     	:= 	acols[n,nQ] // QUANT SEGUNDA UNIDADE 

DbSelectArea("SB1")
SB1->(DbSetOrder(1))

If SB1->(DbSeek(xFilial("SB1")+cProduto))

	_cxp	:=	SB1->B1_I_CXPAL

Endif

If _cxp <> 0

	If mod(qtdx,_cxp) > 0

		nqtv := int(qtdx /_cxp) + 1 		

	else

		nqtv := int(qtdx /_cxp) 

	endif

Endif
	
RestArea(aArea)

RETURN int(nqtv)